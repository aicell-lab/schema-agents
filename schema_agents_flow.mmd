graph TD
    UserQuery[User Query/Task] --> AgentRun[Agent Run Method]
    AgentRun --> CheckStrategy{Has reasoning strategy?}
    
    CheckStrategy -->|Yes| SelectStrategy[Select Reasoning Strategy]
    CheckStrategy -->|No| BasicAgent[Basic Agent Processing]
    
    SelectStrategy --> ReActStrategy{Strategy: ReAct?}
    ReActStrategy -->|Yes| ExecuteReAct[Execute ReAct Reasoning]
    ReActStrategy -->|No| OtherStrategies[Other Strategies]
    
    ExecuteReAct --> CreateThought[Create Initial Thought]
    CreateThought --> ThoughtNode[Generate Reasoning]
    
    ThoughtNode --> CheckToolCall{Tool call needed?}
    CheckToolCall -->|Yes| ActionNode[Create Action]
    CheckToolCall -->|No| CheckFinalAnswer{Final answer ready?}
    
    ActionNode --> ExecuteTool[Execute Tool]
    ExecuteTool --> ObservationNode[Process Observation]
    ObservationNode --> CheckLoopCount{Max loops reached?}
    
    CheckLoopCount -->|Yes| ForceFinalAnswer[Force Final Answer]
    CheckLoopCount -->|No| ThoughtNode
    
    CheckFinalAnswer -->|Yes| FinalAnswerNode[Generate Final Answer]
    CheckFinalAnswer -->|No| ThoughtNode
    
    ForceFinalAnswer --> FinalAnswerNode
    FinalAnswerNode --> ReturnResult[Return Result]
    
    BasicAgent --> ModelRequest[Create Model Request]
    ModelRequest --> ProcessResponse[Process Model Response]
    ProcessResponse --> HandleToolCalls{Tool calls?}
    
    HandleToolCalls -->|Yes| ExecuteBasicTools[Execute Tools]
    HandleToolCalls -->|No| ReturnBasicResult[Return Result]
    ExecuteBasicTools --> ReturnBasicResult
    
    subgraph MemoryTracking
    CreateThought --> AddMemory[Add to Memory]
    ActionNode --> AddMemory
    ObservationNode --> AddMemory
    FinalAnswerNode --> AddMemory
    end
    
    subgraph AgentForking
    AgentRun --> ForkAgent[Fork Agent Copy]
    ForkAgent --> AttachRuntimeTools[Attach Runtime Tools]
    end 